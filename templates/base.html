<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Forum</title>
		<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
	    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
	</head>
<body>
<header>
    <div class="container" style="display: flex; justify-content: space-between">
    	<div class="left">
	    	<a href="/posts">Posts</a>
	    	<a href="/post_create">Create Post</a>
	    </div>
    	<div class="right">
			{% if current_user.is_authenticated %}
			<a href="/notifications">notifications ({{current_user.notifications|length}})</a>
			<a href="/user/{{current_user.id}}">{{current_user.username}}</a>
			<a href="/logout">Logout</a>
			{% else %}
			<a href="/login">Login</a>
			{% endif %}
	    </div>
    </div>
</header>
<main>
	<hr>
    {% block content %} 
    {% endblock %} 

	{%if current_user.is_authenticated %}
	<div id="reply-form-template" style="display: none;">
	    <form method="POST">
	        {{ form1.csrf_token }}
	        <fieldset class="form-group">
	            <legend class="border-bottom mb-4">comment post</legend>

	            <div class="form-group">
	                {{ form1.rid(class="form-control form-control-lg",value=id,readonly=true,hidden=true) }}
	            </div>
	            <div class="form-group">
	                {{ form1.pid(class="form-control form-control-lg",value=id,readonly=true,hidden=true) }}
	            </div>

	            <div class="form-group">
	                {{ form1.content.label(class="form-control-label") }}
	                {{ form1.content(class="form-control form-control-lg") }}
	            </div>
	            {% if form1.content.errors %}
	                <ul class="errors">
	                    {% for error in form1.content.errors %}
	                        <li>{{ error }}</li>
	                    {% endfor %}
	                </ul>
	            {% endif %}

	            <div class="form-group">
	                {{ form1.submit1(class="btn btn-outline-info") }}
	            </div>
	        </fieldset>
	    </form>
	</div>
    {% endif %}

</main>
    <script>
	document.addEventListener("DOMContentLoaded", function() {
	    // Add event listeners to all reply buttons
	    document.querySelectorAll('.reply-btn').forEach(function(button) {
	        button.addEventListener('click', function() {
	            
	            // Remove any existing reply forms
	            const existingForms = document.querySelectorAll('.reply-form');
	            existingForms.forEach(function(form) {
	                form.remove();
	            });

	            // Get the form template
	            const formTemplate = document.getElementById('reply-form-template').innerHTML;
	            
	            // Create a new div to hold the form
	            const replyFormDiv = document.createElement('div');
	            replyFormDiv.classList.add('reply-form');  // Add class to identify reply forms
	            replyFormDiv.innerHTML = formTemplate;
	            
	            const postId = this.getAttribute('data-post-id');
	            const rootId = this.getAttribute('data-root-id');
	            
	            const pidInputField = replyFormDiv.querySelector('input[name="pid"]');
	            pidInputField.value = postId;

	            const ridInputField = replyFormDiv.querySelector('input[name="rid"]');
	            ridInputField.value = rootId;
	            
	            // Find the specific post div by ID and append the form under it
	            const postDiv = document.getElementById(postId);
	            postDiv.appendChild(replyFormDiv);
	            
	        });
	    });
	});
    </script>
</body>
</html>
